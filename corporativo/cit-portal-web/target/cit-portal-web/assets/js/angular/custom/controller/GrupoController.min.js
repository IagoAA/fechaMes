citApp.controller("GrupoController",["$scope","GrupoRepository","$translate","$timeout","UsuarioRepository","PrivilegioRepository","$filter",function(a,g,f,n,k,l,r){a.grupoUsuariosSource=[];a.usuariosTarget=[];a.rolesSource=[];a.rolesTarget=[];a.grupoPrivilegiosSource=[];a.privilegiosTarget=[];a.TIPO_ROLE="tipoRole";a.filterCriteriaUsuario={start:1,dir:"asc",sort:"id",limit:10,fields:["id","username"],filters:[{type:"numeric",field:"organizacao.id",value:a.usuarioLogado.organizacao.id}]};a.filterCriteriaPrivilegio=
{start:1,dir:"asc",sort:"id",limit:10,fields:["id","nome"]};a.saveOrUpdate=function(){a.formGrupo.$submitted=!0;a.formGrupo.$error.email?a.showAlert("error",f.instant("MSG.EMAIL_INVALIDO")):a.formGrupo.$invalid?a.showAlert("error",f.instant("MSG.MN001")):(a.setLoadingSalva(!0),g.save(a.grupo).then(function(b){a.grupo=b.originalElement;a.apresentarBotaoBloquear=!a.grupo.dataBloqueio;a.setLoading(!1);a.findUsuarioSource();a.findPrivilegioSource();a.showAlert("success",f.instant("MSG.MG001"))}))};a.getGrupo=
function(b,c){a.formGrupo.$submitted=!1;a.setLoadingGet(!0);a.resetForm();g.get(b).then(function(b){a.grupo=b.originalElement;a.isVisualizar=c;a.apresentarBotaoBloquear=!a.grupo.dataBloqueio;a.findUsuarioSource();a.findPrivilegioSource();a.setLoading(!1)})};a.findUsuarioSource=function(){a.grupoUsuariosSource=[];k.getListPage(a.filterCriteriaUsuario).then(function(a){h(a.originalElement.objects)})};a.searchByUsuario=function(a){k.findAutoComplete("username",a).then(function(a){h(a)})};a.searchUsuarioByPessoaColaborador=
function(a){PessoaRepository.findPessoaColaboradorUsuarioPorNome("nome",nome).then(function(a){h(a)})};var h=function(b){for(var c=0;c<b.length;c++){var d=b[c],e={};e.usuario=d.originalElement?d.originalElement:d;p(e)}if(a.grupo&&a.grupo.grupoUsuarios)for(c=0;c<a.grupo.grupoUsuarios.length;c++)d=a.grupo.grupoUsuarios[c],e={usuario:{id:d.usuario.id}},b=_.findIndex(a.grupoUsuariosSource,e),0<=b&&(a.grupoUsuariosSource[b]=d);a.grupoUsuariosSource=_.sortBy(a.grupoUsuariosSource,function(a){return a.usuario.username})},
p=function(b){0>_.findIndex(a.grupoUsuariosSource,{usuario:{id:b.usuario.id}})&&a.grupoUsuariosSource.push(b)};a.findPrivilegioSource=function(){a.grupoPrivilegiosSource=[];l.getListPage(a.filterCriteriaPrivilegio).then(function(a){m(a.originalElement.objects)})};a.searchByPrivilegio=function(a){l.findAutoComplete("nome",a).then(function(a){m(a)})};var m=function(b){for(var c=0;c<b.length;c++){var d=b[c],e={};e.privilegio=d.originalElement?d.originalElement:d;q(e)}if(a.grupo&&a.grupo.grupoPrivilegios)for(c=
0;c<a.grupo.grupoPrivilegios.length;c++)d=a.grupo.grupoPrivilegios[c],e={privilegio:{id:d.privilegio.id}},b=_.findIndex(a.grupoPrivilegiosSource,e),0<=b&&(a.grupoPrivilegiosSource[b]=d);a.grupoPrivilegiosSource=_.sortBy(a.grupoPrivilegiosSource,function(a){return a.privilegio.nome})},q=function(b){0>_.findIndex(a.grupoPrivilegiosSource,{privilegio:{id:b.privilegio.id}})&&a.grupoPrivilegiosSource.push(b)};a.apresentarDialogConfirmacaoRemocao=function(){a.$openModalConfirm({message:f.instant("LABEL.CONFIRMA_EXCLUSAO"),
callback:a.remover})};a.remover=function(){a.setLoadingRemove(!0);g.remove(a.grupo).then(function(b){a.setLoadingRemove(!1);a.resetForm();a.showAlert("success",f.instant("MSG.MG001"))});a.$modalConfirmInstance.dismiss("cancel")};a.bloquear=function(){a.grupo.dataBloqueio?a.saveOrUpdate():a.showAlert("error",f.instant("MSG.MG011"))};a.desbloquear=function(){a.grupo.dataBloqueio=null;a.saveOrUpdate()};a.resetForm=function(){a.grupo={grupoUsuarios:[],grupoPrivilegios:[]};a.isVisualizar=!1;a.usuariosTarget=
[];n(function(){a.formGrupo.$submitted=!1;a.formGrupo.$setPristine()})};a.fetchResult=function(){angular.element("#searchGrupo").scope().fetchResult()};a.habilitarEdicao=function(){a.isVisualizar=!1}}]);