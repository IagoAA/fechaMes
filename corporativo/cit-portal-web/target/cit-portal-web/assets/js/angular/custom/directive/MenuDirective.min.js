citApp.directive("menu",["$timeout","$rootScope","MenuRepository","$injector","$translate",function(p,d,k,l,q){return{replace:!0,templateUrl:"assets/js/angular/custom/directive/html/menu.html",link:function(a,r,g){a.menuList=[];a.searchMenuItens=[];a.businessProcesses=[];var s={start:1,dir:"asc",sort:"name",limit:999999,fields:["id","category.name","description","flow.description","menu"]},h=void 0,m=g=void 0;try{h=l.get("BusinessProcessRepository"),g=l.get("RuntimeManagerRepository"),m=l.get("FlowRepository"),
a.runtimeManagerUtils=new RuntimeManagerUtils(a,a,q,g)}catch(w){}var t=h&&g&&m&&a.runtimeManagerUtils;a.$watch("$navContainerShow",function(){d.$navContainerShow=a.$navContainerShow});var f=function(b){if(b&&0<b.length){35===b.id&&console.log("id: 35");for(var e=0;e<b.length;e++){var c=b[e];c.submenuList=[];a.addBusinessProcess(c);for(var n=0;n<c.submenu.length;n++){var d=c.submenu[n];d.coluna||(d.coluna=0);c.submenuList[d.coluna]||(c.submenuList[d.coluna]=[]);c.submenuList[d.coluna].push(d)}}}},
u=r.find(".nav-item-search input"),v=function(){a.searchMenuInput="";p(function(){u.focus()})};a.openAndCloseNav=function(){a.$navContainerShow=!a.$navContainerShow;v()};a.$on("menuController-menuDirective",function(b,e){e&&k.getAllMenusAtivos().then(function(b){a.menuList=b;f(a.menuList)})});a.openLink=function(b){b.businessProcess?a.startBusinessProcess(b):a.openWorkspaceIfNotOpen(b.pagina.nome?b.pagina.nome:b.nome,b.pagina.pagina?b.pagina.pagina:"",b.classePagina);a.resetSearchMenu();a.openAndCloseNav()};
a.hasChildren=function(a){return a.submenu?0<a.submenu.length:!1};a.canSearchInServer=function(){return a.searchMenuInput?3<=a.searchMenuInput.length:!1};a.searchMenu=function(){if(a.canSearchInServer()){var b=a.searchMenuInput,e=a.searchMenuInput;k.findByName(b).then(function(c){p(function(){e===b&&(a.searchMenuItens=[],a.searchMenuItens=c)})})}};a.searchMenuIsEmpty=function(){return a.searchMenuItens?0>=a.searchMenuItens.length:!1};a.resetSearchMenu=function(){a.searchMenuInput="";a.searchMenuItens=
[]};a.addBusinessProcess=function(b){if(0<a.businessProcesses.length){var e=0;angular.forEach(b.submenu,function(c){angular.forEach(a.businessProcesses,function(a){a.menu.id==c.id&&(e++,c.submenu.push({nome:a.description,parent:c,ativo:!0,ordem:e,coluna:c.coluna,cor:c.cor,cssMenu:c.cssMenu,cssMenuOpacity:c.cssMenuOpacity,classePagina:c.classePagina,businessProcess:a,breadcrumbs:[b.nome,c.nome,a.description]}))})})}};a.startBusinessProcess=function(b){var e=b.businessProcess;a.runtimeManagerUtils.existsWorkspace("/cit-esi-web/assets/js/angular/custom/directive/html/startBusinessProcess.html")?
a.showAlert("warning",q.instant("ESI.MSG.JA_EXISTE_TELA_PROCESSO")):h.get(e.id).then(function(c){d.businessProcess=c.originalElement;d.controllerScope=a;d.listaBreadcrumb=b.breadcrumbs;a.addNewWorkspace(d.businessProcess.description,"/cit-esi-web/assets/js/angular/custom/directive/html/startBusinessProcess.html",!0,b.classePagina,d.businessProcess)})};(function(){a.$navContainerShow=!1;k.getAllMenusAtivos().then(function(b){a.menuList=b;t?m.getByName("esi_service_groups").then(function(b){b=b&&b.originalElement&&
b.originalElement.id?b.originalElement:void 0;!b||b.flow.dataBloqueio&&null!=b.flow.dataBloqueio?f(a.menuList):h.getProcessesWithMenu(a.usuarioLogado.username,s).then(function(b){b&&b.originalElement&&b.originalElement.objects&&0<b.originalElement.objects.length&&(a.businessProcesses=b.originalElement.objects);f(a.menuList)},function(){f(a.menuList)})}):f(a.menuList)})})()}}}]);