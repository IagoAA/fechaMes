citApp.controller("MenuController",["$scope","$translate","$timeout","MenuRepository","MenuFileRepository","DominioRepository","$rootScope","PrivilegioRepository","GrupoRepository","$filter",function(a,e,p,g,k,q,r,s,m,t){a.MENU_MAIN_TYPE="menuMain";a.SUBMENU_TITLE_TYPE="submenuTitle";a.SUBMENU_LINK_TYPE="submenuLink";a.menuList=[];a.menuSelected={};a.menu={};a.$translate=e;a.filterCriteriaGrupo={start:1,dir:"asc",sort:"id",limit:10,fields:["id","nome"],filters:[{type:"numeric",field:"organizacao.id",
value:a.usuarioLogado.organizacao.id}]};a.radioValueList=[{text:e.instant("LABEL.SIM"),value:!0},{text:e.instant("LABEL.NAO"),value:!1}];var n=function(){a.$modalConfirmInstance&&a.$modalConfirmInstance.dismiss("cancel")},u=function(b){a.setLoadingGet(!0);g.saveOrdem(b).then(function(b){a.menuList=b;a.showAlert("success",e.instant("MSG.MENU_ORDEM_SALVA"));a.setLoadingGet(!1)})},v=function(b){a.setLoadingGet(!0);g.saveOrdem(b).then(function(b){a.showAlert("success",e.instant("MSG.MENU_ORDEM_SALVA"));
a.setLoadingGet(!1);a.selectMenu(a.menuSelected)})};a.init=function(){a.menuList=[];a.menu={};g.getAllParent().then(function(b){if(b&&0<b.length)for(var c=0;c<b.length;c++)b[c].originalElement.$type="menuMain",a.menuList.push(b[c].originalElement);p(function(){a.$emit("menuController-menuDirective",a.menuList)})})};a.sliceBigger=0;a.getOrdemSubmenuTitle=function(b,c,d){return 0===b?(a.sliceBigger=d.length,c):b*c+a.sliceBigger*b};a.treeOptions={accept:function(a,c,d){a=a.$modelValue;c=c.$element.attr("data-type");
return a.$type==c},dropped:function(b){var c=b.dest.nodesScope;b=[];if("menuMain"===c.$element.attr("data-type"))b=a.menuList,u(b);else if("submenuTitle"===c.$element.attr("data-type")||"submenuLink"===c.$element.attr("data-type")){b=a.menuSelected.submenu;for(c=0;c<b.length;c++)b[c].parent={id:a.menuSelected.id};v(b)}}};a.addMenuModule=function(){a.menu={ativo:!0};a.$openModal("html/menu/addOrUpdateMenuModule.html")};a.editMenuModule=function(b){a.setLoadingGet(!0);g.get(b.id).then(function(b){a.menu=
b.originalElement;a.findGrupo();a.findPrivilegios();a.setLoadingGet(!1);a.$openModal("html/menu/addOrUpdateMenuModule.html")})};a.addMenuTitle=function(){a.menu={ativo:!0,parent:{id:a.menuSelected.id}};a.$openModal("html/menu/addOrUpdateMenuTitle.html")};a.editMenuTitle=function(b){a.setLoadingGet(!0);g.get(b.id).then(function(b){a.menu=b.originalElement;a.menu.parent={id:a.menuSelected.id};a.findGrupo();a.findPrivilegios();a.setLoadingGet(!1);a.$openModal("html/menu/addOrUpdateMenuTitle.html")})};
a.addMenuLink=function(b){a.menu={ativo:!0,parent:{id:b.id}};a.$openModal("html/menu/addOrUpdateMenuLink.html","lg")};a.editMenuLink=function(b,c){a.setLoadingGet(!0);g.get(b.id).then(function(b){a.menu=b.originalElement;a.menu.parent={id:c.id};a.findGrupo();a.findPrivilegios();a.setLoadingGet(!1);a.$openModal("html/menu/addOrUpdateMenuLink.html","lg")})};a.selectMenu=function(b){a.setLoadingGet(!0);w(b)};var w=function(b){g.findMenuByIdParent(b).then(function(c){b.submenuList=[];for(var d=[],h=0;h<
c.length;h++){var f=c[h].originalElement;f.$type="submenuTitle";if(f.submenu&&0<f.submenu.length)for(var e=0;e<f.submenu.length;e++)f.submenu[e].$type="submenuLink";d[h]=f}c=d;b.submenu=c;d=[];if(c&&0<c.length){for(h=0;h<c.length;h++)f=c[h],f.coluna||(f.coluna=0),d[f.coluna]||(d[f.coluna]=[]),d[f.coluna].push(f);c=d}else c=void 0;b.submenuList=c;if((c=b.submenuList)&&0<c.length)for(d=0;3>d;d++)c[d]||(c[d]=[],c[d].push({}));a.menuSelected=b;a.setLoadingGet(!1)})};a.removeMenu=function(b){a.$openModalConfirm({callback:function(){g.remove(b).then(function(){n();
a.showAlert("success",e.instant("MSG.MENU_EXCLUIDO_COM_SUCESSO"));a.menuSelected.id===b.id?a.menuSelected={}:a.menuSelected.id&&a.selectMenu(a.menuSelected);a.init()})}})};a.saveOrUpdateMenu=function(){a.menuForm.$submitted=!0;a.menuForm.$valid?(a.setLoadingSalva(!0),g.save(a.menu).then(function(b){a.menuForm.$submitted=!1;a.menuForm.$setPristine(!1);a.$modalInstance&&a.$modalInstance.dismiss("cancel");a.setLoadingSalva(!1);a.showAlert("success",e.instant("MSG.MENU_SALVO_COM_SUCESSO"));a.menuSelected&&
a.menuSelected.id&&a.selectMenu(a.menuSelected);a.init()})):a.showAlert("error",e.instant("VALIDACAO.ALERTA_OBRIGATORIOS")," ",!1)};var l=function(){a.setLoadingGet(!0);k.findByIdMenu(a.menu).then(function(b){a.menu.includes=b;a.setLoadingGet(!1)})};a.menuFileList=function(b){a.menu=b;q.findAllDominio("tipoFile").then(function(b){a.dominioMenuFileList=[];for(var d=0;d<b.length;d++)a.dominioMenuFileList.push(b[d].originalElement)});l();a.$openModal("html/menu/menuFileList.html","lg")};a.editMenuFile=
function(b){a.setLoadingGet(!0);k.get(b.id).then(function(b){a.include=b.originalElement;a.setLoadingGet(!1)})};a.removeMenuFile=function(b){a.$openModalConfirm({callback:function(){k.remove(b).then(function(){n();a.showAlert("success",e.instant("MSG.MENU_FILE_EXCLUIDO_COM_SUCESSO"));l();r.isMenuAlterado=!0})}})};a.saveOrUpdateMenuFile=function(){a.menuFileForm.$submitted=!0;a.menuFileForm.$valid?(a.setLoadingSalva(!0),a.include.menu={id:a.menu.id},k.save(a.include).then(function(b){a.include={};
a.menuFileForm.$submitted=!1;a.menuFileForm.$setPristine(!1);a.setLoadingSalva(!1);a.showAlert("success",e.instant("MSG.MENU_FILE_SALVO_COM_SUCESSO"));l()})):a.showAlert("error",e.instant("VALIDACAO.ALERTA_OBRIGATORIOS")," ",!1)};a.init();a.findPrivilegios=function(){a.privilegios=[];s.getList().then(function(b){a.prepareMenuPrivilegio(b)})};a.prepareMenuPrivilegio=function(b){for(var c=0;c<b.length;c++){var d=b[c],e={};e.privilegio=d.originalElement?d.originalElement:d;a.addToMenuPrivilegioIfNotExist(e)}a.privilegios=
_.sortBy(a.privilegios,function(a){return a.privilegio.nome})};a.addToMenuPrivilegioIfNotExist=function(b){var c={privilegio:{id:b.privilegio.id}},d=_.findIndex(a.menu.menuPrivilegios,c),c=_.findIndex(a.privilegios,c);0>d&&0>c&&a.privilegios.push(b)};a.searchByGrupo=function(b){b&&""!=b&&m.findAutoComplete("nome",b).then(function(b){a.prepareMenuGrupo(b)})};a.findGrupo=function(){a.grupos=[];m.getListPage(a.filterCriteriaGrupo).then(function(b){a.prepareMenuGrupo(b.originalElement.objects)})};a.prepareMenuGrupo=
function(b){for(var c=0;c<b.length;c++){var d=b[c],e={};e.grupo=d.originalElement?d.originalElement:d;a.addToMenuGrupoIfNotExist(e)}a.grupos=_.sortBy(a.grupos,function(a){return a.grupo.nome})};a.addToMenuGrupoIfNotExist=function(b){var c={grupo:{id:b.grupo.id}},d=_.findIndex(a.menu.menuGrupos,c),c=_.findIndex(a.grupos,c);0>d&&0>c&&a.grupos.push(b)};a.aplicarFiltroUpper=function(){a.menu.chave=t("uppercase")(a.menu.chave)}}]);