citApp.directive("filtros",["$modal","PaginaUsuarioRepository","UsuarioRepository","$translate","FiltroRepository",function(e,f,g,c,h){return{scope:{filtros:"\x3dngFilter",workspace:"\x3dngWorkspace"},replace:!0,restrict:"EA",templateUrl:"assets/js/angular/custom/directive/html/filtros.html",controller:["$scope",function(a){a.$appControllerScope=angular.element("#citapp-controller").scope();var c=a.$appControllerScope.recuperarPaginaUsuario(a.workspace);c&&c.searchParams&&(a.filters=c.searchParams)}],
link:function(a,g,k){a.setFiltro=function(b){angular.forEach(b.filters,function(b,c){b.dominio&&(b.listaDominio=a.$parent.filterCriteria.filters[c].listaDominio)});b=angular.copy(b);a.filtros=b;a.$parent.filterCriteria=b;a.$parent.$parent.filterCriteria=b;a.$parent.filterResult(b.keywordValue);a.$parent.$broadcast("filtroDirective-listViewDirective",!0)};a.removeFilter=function(b){a.$appControllerScope.$openModalConfirm({message:c.instant("LABEL.CONFIRMA_EXCLUSAO"),callback:function(){a.$appControllerScope.setLoadingRemove(!0);
angular.forEach(a.filters,function(d){b.id===d.id&&h.remove(b).then(function(b){b&&(b=a.filters.indexOf(d),a.filters.splice(b,1));a.$appControllerScope.setLoading(!1);a.$appControllerScope.showAlert("success",c.instant("MSG.MG001"))})});a.$appControllerScope.$modalConfirmInstance.dismiss("cancel")}})};a.limparFiltro=function(){a.filtros.nome=""};a.openModal=function(b,c){void 0!==b&&(a.$modalInstance=e.open({templateUrl:b,size:c,windowClass:"modal-buttons-top "+this.workspace.classePagina,scope:this}))};
a.salvarFiltro=function(b,d){a.$appControllerScope.setLoadingPesquisa(!0);if(!a.filtros.nome)return a.$appControllerScope.showAlert("error",c.instant("MSG.NOME_FILTRO_VAZIO")),a.$appControllerScope.setLoadingPesquisa(!1),a.$modalInstance.dismiss("cancel"),!1;if(a.filtros.filters&&0<a.filtros.filters.length&&!a.filtros.filters.some(function(a){return a.value||a.valueMin||a.valueMax})&&!a.filtros.keywordValue)return a.$appControllerScope.showAlert("error",c.instant("MSG.CAMPOS_FILTROS_VAZIOS")),a.$appControllerScope.setLoadingPesquisa(!1),
a.$modalInstance.dismiss("cancel"),!1;delete b.id;angular.forEach(b.filters,function(a,b){delete a.id;a.listaDominio&&(a.dominio=!0)});var e={pagina:getMontarPagina(d),searchParams:b};f.salvarFilter(e).then(function(b){a.$modalInstance.dismiss("cancel");a.filters||(a.filters=[]);a.filters.push(b.originalElement);a.$appControllerScope.atualizarUsuarioLogado();a.$appControllerScope.setLoadingPesquisa(!1);a.$appControllerScope.showAlertSucesso("success",c.instant("MSG.SUCESSO_FILTRO_SALVO"))});a.$modalInstance.dismiss("cancel")};
a.atualizarFiltros=function(){a.$appControllerScope.atualizarUsuarioLogado()}}}}]);