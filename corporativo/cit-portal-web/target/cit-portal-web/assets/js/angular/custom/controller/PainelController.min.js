citApp.controller("PainelController",["$scope","PainelRepository","$translate","$timeout","DominioRepository","ModuloRepository","GrupoRepository","$filter","PrivilegioRepository",function(a,l,h,k,r,n,p,m,q){a.model={};a.painelItens=[];a.widgtsRemovidos=[];a.TIPO_DADO_URL_CODIGO=9;a.saveOrUpdate=function(){a.formPainel.$submitted=!0;a.formPainel.$invalid?a.showAlert("error",h.instant("MSG.MN001")):(a.setLoadingSalva(!0),a.atualizarPainelItens(),l.save(a.painel).then(function(b){a.painel=b.originalElement;
a.montarDashBoard();a.apresentarBotaoBloquear=!a.painel.dataBloqueio;a.setLoading(!1);a.showAlert("success",h.instant("MSG.MG001"))}))};a.atualizarPainelItens=function(){angular.forEach(a.model.rows,function(b){angular.forEach(b.columns,function(b,g){var f=1;angular.forEach(b.widgets,function(d){var c=a.obterPainelItenPorId(d.idPainelItem);c?(c.type=d.type,c.nome=d.title,c.posicaoColumn=g,c.posicaoLinha=f,f++,c.styleClass=b.styleClass,c.remover=d.remover,c.urlServico=d.config.path,c.painelItemParametros=
d.config.parametros,c.tempoAtualizacao=d.config.tempoAtualizacao,c.links=d.config.links,c.painelItemGrupos=d.config.widgetGrupos,c.painelItemPrivilegios=d.config.widgetPrivilegios):d.remover||(c={},c.type=d.type,c.nome=d.title,c.posicaoColumn=g,c.posicaoLinha=f,c.styleClass=b.styleClass,c.urlServico=d.config.path,c.widget=d.widget,c.links=d.config.links,c.tempoAtualizacao=d.config.tempoAtualizacao,c.painelItemGrupos=d.config.widgetGrupos,c.painelItemPrivilegios=d.config.widgetPrivilegios,f++,a.painel.painelItens.push(c))})})})};
a.obterPainelItenPorId=function(b){var e=null;angular.forEach(a.painel.painelItens,function(a){b&&a.id===b&&(e=a)});return e};a.getPainel=function(b,e){a.formPainel.$submitted=!1;a.setLoadingGet(!0);l.get(b).then(function(b){a.painel=b.originalElement;a.montarDashBoard();a.isVisualizar=e;a.apresentarBotaoBloquear=!a.painel.dataBloqueio;a.findPainelGrupoSource();a.findPainelPrivilegioSource();a.findPainelModuloSource();a.setLoading(!1)})};a.montarDashBoard=function(){if(a.painel.painelItens){a.ordenarLista(a.painel.painelItens,
"posicaoColumn");var b=[],e={},g=[],f=[],d={},c=0,h=100;angular.forEach(a.painel.painelItens,function(b){var e={};e.title=b.nome;e.type=b.type;e.posicaoLinha=b.posicaoLinha;e.idPainelItem=b.id;e.widget=b.widget;e.remover=!1;e.config={path:b.urlServico,parametros:b.painelItemParametros,apresentarUrl:b.widget.apresentarUrlServico,tempoServico:h,links:b.links,tempoAtualizacao:b.tempoAtualizacao,widgetGrupos:b.painelItemGrupos,widgetPrivilegios:b.painelItemPrivilegios};h+=200;b.posicaoColumn==c?(d.styleClass=
b.styleClass,g.push(e)):(a.ordenarLista(g,"posicaoLinha"),d.widgets=g,f.push(d),g=[],d={},d.styleClass=b.styleClass,g.push(e),c++)});a.ordenarLista(g,"posicaoLinha");d.widgets=g;f.push(d);e.columns=f;b.push(e);a.model.rows=b;a.name=a.painel.nome}};a.ordenarLista=function(a,e){a.sort(function(a,b){a=parseInt(a[e]);b=parseInt(b[e]);return a-b});return a};a.apresentarDialogConfirmacaoRemocao=function(){a.$openModalConfirm({message:h.instant("LABEL.CONFIRMA_EXCLUSAO"),callback:a.remover})};a.remover=
function(){a.setLoadingRemove(!0);l.remove(a.painel).then(function(b){a.setLoadingRemove(!1);a.resetForm();a.showAlert("success",h.instant("MSG.MG001"))});a.$modalConfirmInstance.dismiss("cancel")};a.bloquear=function(){a.painel.dataBloqueio?a.saveOrUpdate():a.showAlert("error",h.instant("MSG.MG011"))};a.desbloquear=function(){a.painel.dataBloqueio=null;a.saveOrUpdate()};a.resetForm=function(){a.painel={painelItens:[],painelGrupos:[],painelPrivilegios:[],painelModulos:[]};a.findPainelGrupoSource();
a.findPainelPrivilegioSource();a.findPainelModuloSource();a.iniciarEstruturaDashBoard();a.isVisualizar=!1;k(function(){a.formPainel.$submitted=!1;a.formPainel.$setPristine()})};a.fetchResult=function(){angular.element("#searchPainel").scope().fetchResult();a.removeIntervalDashboard()};a.abilitarEditar=function(){a.isVisualizar=!1};a.findPainelGrupoSource=function(){a.painelGrupoSource=[];p.getList().then(function(b){b.forEach(function(b,g){var f={};f.grupo=b.originalElement;a.painelGrupoSource.push(f)});
k(function(){a.painelGrupoSource=m("idNotEqualGrupoSourcePickList")(a.painelGrupoSource,a.painel.painelGrupos)})})};a.findPainelPrivilegioSource=function(){a.painelPrivilegioSource=[];q.getList().then(function(b){b.forEach(function(b,g){var f={};f.privilegio=b.originalElement;a.painelPrivilegioSource.push(f)});k(function(){a.painelPrivilegioSource=m("idNotEqualPrivilegioSourcePickList")(a.painelPrivilegioSource,a.painel.painelPrivilegios)})})};a.findPainelModuloSource=function(){a.painelModuloSource=
[];n.getList().then(function(b){b.forEach(function(b,g){var f={};f.modulo=b.originalElement;a.painelModuloSource.push(f)});k(function(){a.painelModuloSource=m("idNotEqualModuloSourcePickList")(a.painelModuloSource,a.painel.painelModulos)})})};a.iniciarEstruturaDashBoard=function(){a.model={structure:"4-8",rows:[{columns:[{styleClass:"col-md-4",widgets:[]},{styleClass:"col-md-8",widgets:[]}]}]}};a.$on("adfDashboardChanged",function(b,e,g){a.saveOrUpdate()})}]);