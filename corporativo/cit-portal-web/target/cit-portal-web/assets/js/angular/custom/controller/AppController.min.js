citApp.controller("AppController",["$scope","$routeParams","$timeout","$location","$anchorScroll","$filter","$window","$translate","$modal","$document","growl","PaginaUsuarioRepository","UsuarioRepository","NotificacaoRepository","$rootScope","paginationConfig","datepickerPopupConfig","$injector","ModuloRepository","$http","$sce","MenuRepository","IndexRepository",function(a,K,m,C,D,q,w,d,n,E,p,F,l,x,g,r,t,G,L,y,z,A,H){function h(){var b=[];a.workspaces&&0<a.workspaces.length&&(b=a.workspaces.filter(function(a){return a.active}));
a.workspaceAtiva=0<b.length?b[0]:null}a.$translate=d;a.notificacao={};a.MASK_CPF="999.999.999.99";a.MASK_CNPJ="99.999.999/9999-99";a.LIMITE_FAVORITO_MENU=5;a.paginasUsuarioFavoritoTemp=[];a.usuarioLogado={};a.informacaoSistema={};l.getUsuarioLogado().then(function(b){a.usuarioLogado=b.originalElement;a.usuarioLogado.organizacao.dataReferenciaVigente=converterStringEmDate(a.usuarioLogado.organizacao.dataReferenciaVigente);a.usuarioLogado.organizacoes=q("itemOrganizacaoDistinct")(a.usuarioLogado.organizacoes,
a.usuarioLogado.organizacao)});a.atualizarUsuarioLogado=function(){l.getUsuarioLogado().then(function(b){a.usuarioLogado=b.originalElement;a.usuarioLogado.organizacao.dataReferenciaVigente=converterStringEmDate(a.usuarioLogado.organizacao.dataReferenciaVigente);a.usuarioLogado.organizacoes=q("itemOrganizacaoDistinct")(a.usuarioLogado.organizacoes,a.usuarioLogado.organizacao)})};a.idObejct=0;a.newObejct=!1;a.mensagemLoading="Inicializando Aguarde...";a.edit=!0;a.openWorkspaceIfNotOpen=function(b,c,
e,d){for(var f=void 0,k=0;k<a.workspaces.length;k++)a.workspaces[k].page==c&&(f=a.workspaces[k]);void 0===f?a.addNewWorkspace(b,c,!0,e,d):(s(),f.active=!0)};a.openNotificacoes=function(){a.openMenuPorNome(d.instant("LABEL.NOTIFICACAO"))};a.openWorkspaceFavorito=function(b,c,e,d){A.buscarMenusPorPagina({pagina:c}).then(function(e){a.openWorkspaceIfNotOpen(b,c,e.originalElement.classePagina,d)})};a.openMenuPorNome=function(b){A.obterPorNome(b).then(function(b){b=b.originalElement;a.openWorkspaceIfNotOpen(b.nome,
b.pagina.pagina,b.classePagina,!0)})};g.findNotificacoes=function(){x.findNotificacaoUsuario().then(function(a){g.quantidadeNotificacoesNaoLidas=a.length;g.listaNotificacoesUsuario=a})};g.findNotificacoes();a.visualizarNotificacao=function(b){x.visualizar(b.originalElement).then(function(b){a.$openModalNotificacao(b.originalElement.assunto,b.originalElement.mensagem);g.findNotificacoes()})};a.$openModalNotificacao=function(b,c){h();var e={title:b,message:c};angular.extend(e);var d="",d=a.workspaceAtiva?
a.workspaceAtiva.classePagina:"mod-blue";this.$modalNotificacao=e;this.$modalNotificacaoInstace=n.open({templateUrl:"modalNotificacao.html",windowClass:"modal-buttons-top "+d,scope:this})};a.visualizarPerfil=function(){var b=void 0;a.openWorkspaceIfNotOpen(d.instant("LABEL.USUARIO"),"/cit-portal-web/html/usuario/usuario.html","mod-blue",!0);m(function(){a.setLoadingGet(!0);for(var c=0;c<a.workspaces.length;c++)"/cit-portal-web/html/usuario/usuario.html"==a.workspaces[c].page&&(b=a.workspaces[c]);
a.$showPageEditWorkspace(b);m(function(){angular.element("#editUsuario").scope().getUsuario(a.usuarioLogado,!0)},1E3)})};a.changeLanguage=function(b,c){c.preventDefault();c.stopPropagation();d.use(b);a.language=b;angular.element(".language-menu").removeClass("open")};a.openDropdownLanguage=function(a){a.preventDefault();a.stopPropagation();angular.element(".language-menu").addClass("open")};a.language=d.proposedLanguage();a.showException=function(a){var c=u();p.error(d.instant(a.ex?"MSG.ERRO_GENERICO":
a),{title:a.codigoErro?d.instant("CODIGOERRO."+a.codigoErro):"Erro",referenceId:c?c.id:"exception",ttl:1E4})};a.showMensage=function(a){var c=u();a.errosValidacao?angular.forEach(a.errosValidacao,function(a,b){var f="";"701"!=a.codigoErro&&"700"!=a.codigoErro||angular.forEach(a.erros,function(a,b){f=0==b?d.instant(a.label):f+", "+d.instant(a.label)});p.error(f,{title:d.instant("CODIGOERRO."+a.codigoErro),referenceId:c?c.id:"exception",ttl:1E4})}):p.error(d.instant(a.message)+(a.msgComplemento?a.msgComplemento:
""),{title:"",ttl:1E4,referenceId:c?c.id:"exception"})};a.scrollTo=function(a){C.hash(a);D()};a.resetForm=function(a){angular.element("#"+a).scope().resetForm()};a.atualizarLista=function(a){angular.element("#"+a).scope().filterResult()};a.scrollToTopOfPage=function(){w.scrollTo(0,0)};a.setLoadingSalva=function(b){a.scrollToTopOfPage();a.mensagemLoading="Salvando Aguarde...";a.isLoading=b};a.setLoadingPesquisa=function(b){a.scrollToTopOfPage();a.mensagemLoading="Pesquisando Aguarde...";a.isLoading=
b};a.setLoadingRemove=function(b){a.scrollToTopOfPage();a.mensagemLoading="Removendo Aguarde...";a.isLoading=b};a.setLoadingGet=function(b){a.scrollToTopOfPage();a.mensagemLoading="Carregando Aguarde...";a.isLoading=b};a.setLoadingAtualiza=function(b){a.scrollToTopOfPage();a.mensagemLoading="Atualizando Aguarde...";a.isLoading=b};a.setLoading=function(b){a.scrollToTopOfPage();a.isLoading=b};a.setLoading=function(b,c){a.scrollToTopOfPage();a.mensagemLoading=c;a.isLoading=b};a.setLoadingRelatorio=function(b){a.scrollToTopOfPage();
a.mensagemLoading="Gerando Aguarde...";a.isLoading=b};a.showAlert=function(a,c,e){var d=this.workspace;void 0===d&&(d=u());if(void 0!==p[a])p[a](c,{title:e,referenceId:d.id})};a.showAlertSucesso=function(b,c){var e=d.instant("MSG.TITULO_MSG_SUCESSO");a.showAlert(b,c,e)};var I=function(){angular.forEach(a.workspaces,function(a){a.active=!1})};a.setObjectId=function(b){a.idObejct=b};var B=1;a.addNewWorkspace=function(b,c,e,d,f,k,g,h){a.edit=g;e?a.idObejct=0:k&&(a.idObejct=k);a.newObejct=e;e=B++;s();
b={id:e,name:b,page:c,active:!0,favorito:!1,classePagina:d,paginaId:f,$showSearch:!0,$showEdit:!1,$showRelatorios:!1,idRelatorio:h};c=a.recuperarPaginaUsuario(b);b.favorito=c&&c.favorito?!0:!1;a.workspaces.push(b)};var s=function(){for(var b=a.workspaces,c=0;c<b.length;c+=1)b[c].active=!1},u=function(){for(var b=a.workspaces,c=0;c<b.length;c+=1)if(!0===b[c].active)return b[c];return null};a.$showPageEditWorkspace=function(a){a.$showEdit=!0;a.$showSearch=!1;a.$showOptionalPage=!1};a.$showPageSearchWorkspace=
function(a){a.$showEdit=!1;a.$showSearch=!0;a.$showOptionalPage=!1};a.activeWorkspace=function(a){s();a.active=!0};a.$showOptionalPageWorkspace=function(a){a.$showEdit=!1;a.$showSearch=!1;a.$showOptionalPage=!0};a.removeWorkspace=function(b){var c=a.workspaces,e;for(e=0;e<c.length;e+=1)if(b===c[e].id){var d=c[e+1],f=c[e-1];!0===c[e].active&&(void 0!==d?d.active=!0:void 0!==f&&(f.active=!0));c[e].idRelatorio&&delete a.arrayContentReports[c[e].idRelatorio];a.removeIntervalDashboard();a.workspaces.splice(e,
1)}};a.removeIntervalDashboard=function(){g.listaWidgetIntervals&&(angular.forEach(g.listaWidgetIntervals,function(a){clearInterval(a)}),g.listaWidgetIntervals=[])};a.workspaces=[];a.addWorkspace=function(){I();var b=B++;s();a.workspaces.push({id:b,name:"NAME",active:!0})};a.addFavorito=function(b){var c={pagina:getMontarPagina(b),favorito:b.favorito};F.saveFavorito(c).then(function(c){b.favorito=c.favorito;a.usuarioLogado.paginasUsuario=c.paginasUsuario;for(c=0;c<a.workspaces.length;c++)b.page==
a.workspaces[c].page&&(a.workspaces[c].favorito=b.favorito);a.getPaginasFavoritadas()})};a.getPaginasFavoritadas=function(){a.paginasUsuarioFavoritoTemp=[];angular.forEach(a.usuarioLogado.paginasUsuario,function(b,c){b.favorito&&a.paginasUsuarioFavoritoTemp.push(b)})};a.recuperarPaginaUsuario=function(b){var c;angular.forEach(a.usuarioLogado.paginasUsuario,function(a,d){angular.equals(a.pagina.pagina,b.page)&&(c=a)});return c};a.$openModal=function(b,c){h();void 0!==b&&(this.$modalInstance=n.open({templateUrl:b,
size:c,windowClass:"modal-buttons-top modal-no-backdrop "+a.workspaceAtiva.classePagina,backdrop:!1,scope:this}))};a.$openModalConfirm=function(b){h();var c={title:d.instant("LABEL.CONFIRMACAO"),message:"Deseja realmente excluir?",confirmText:"Confirmar",cancelText:"Cancelar",item:{},items:[],callback:function(){}};angular.extend(c,b);this.$modalConfirm=c;this.$modalConfirmInstance=n.open({templateUrl:"modalConfirm.html",windowClass:"modal-buttons-top "+(a.workspaceAtiva?a.workspaceAtiva.classePagina:
v),scope:this})};a.arrayContentReports={};var J=0;a.visualizarRelatorio=function(b,c){a.titleReport=c;0>b.indexOf("download")&&(getAcrobatInfo().acrobat?b+="\x26download\x3dfalse":(b+="\x26download\x3dtrue",window.location=b));a.setLoadingRelatorio(!0);y.get(b,{responseType:"arraybuffer"}).success(function(b){b=new Blob([b],{type:"application/pdf"});b=URL.createObjectURL(b);a.idRelatorio=++J;a.arrayContentReports[a.idRelatorio]=angular.copy(z.trustAsResourceUrl(b));h();m(function(){a.addNewWorkspace(c,
"relatorioTab.html",!0,a.workspaceAtiva?a.workspaceAtiva.classePagina:v,void 0,void 0,void 0,a.idRelatorio);a.setLoading(!1)})}).error(function(b,c){412==c?a.showAlert("warning",d.instant("MSG.RELATORIO_SEM_DADOS")+" ",!1):a.showAlert("error",d.instant("MSG.ERRO_RELATORIO")+" ",!1);a.setLoading(!1)})};a.visualizarRelatorioModal=function(b){0>b.indexOf("download")&&(getAcrobatInfo().acrobat?b+="\x26download\x3dfalse":(b+="\x26download\x3dtrue",window.location=b));a.setLoadingRelatorio(!0);y.get(b,
{responseType:"arraybuffer"}).success(function(b){b=new Blob([b],{type:"application/pdf"});b=URL.createObjectURL(b);a.content=z.trustAsResourceUrl(b);a.setLoading(!1);a.$openModalRelatorio()}).error(function(b,e){412==e?a.showAlert("warning",d.instant("MSG.RELATORIO_SEM_DADOS")+" ",!1):a.showAlert("error",d.instant("MSG.ERRO_RELATORIO")+" ",!1);a.setLoading(!1)})};a.$openModalRelatorio=function(){h();this.$modalRelatorioInstace=n.open({templateUrl:"relatorio.html",windowClass:"modal-buttons-top "+
a.workspaceAtiva.classePagina,size:"lg",scope:this})};a.visualizarInformacaoSistema=function(b){H.getInformacaoSistema().then(function(b){a.informacaoSistema=b;a.$openModalAbout()})};a.$openModalAbout=function(){var b;h();a.workspaceAtiva||(b="mod-blue");this.$modalAboutInstace=n.open({templateUrl:"about.html",windowClass:"modal-buttons-top "+(a.workspaceAtiva?a.workspaceAtiva.classePagina:b),size:"md",scope:this})};a.validarDataTransferencia=function(b){if(void 0!==b){var c=null;try{c=angular.copy(converterStringEmDate(b))}catch(d){c=
angular.copy(b)}b=converterStringEmDate(a.usuarioLogado.organizacao.dataReferenciaVigente);try{return c.getMonth()==b.getMonth()&&c.getFullYear()==b.getFullYear()}catch(g){return!1}}};m(function(){a.getPaginasFavoritadas();r.previousText=d.instant("LABEL.ANTERIOR");r.nextText=d.instant("LABEL.PROXIMO");r.firstText=d.instant("LABEL.PRIMEIRO");r.lastText=d.instant("LABEL.ULTIMO");t.currentText=d.instant("LABEL.HOJE");t.clearText=d.instant("LABEL.LIMPAR");t.closeText=d.instant("LABEL.FECHAR")},1E3);
a.showAdvancedFilters=function(a,c){a&&(c.$showAdvancedFilters=!1);c.$showAdvancedFilters=!c.$showAdvancedFilters};a.scrollToCadastro=function(a,c){c?w.scrollTo(0,c):m(function(){E.scrollToElementAnimated(angular.element(a))})};var v;a.workspaceAtiva||(v="mod-blue");a.atualizarOrganizacaoUsuario=function(b){h();var c;c=a.workspaceAtiva?1<a.workspaces.length?d.instant("MSG.CONFIRMA_MUDANCA_AMBIENTE_TRABALHO_FECHAR_ABAS"):d.instant("MSG.CONFIRMA_MUDANCA_AMBIENTE_TRABALHO_FECHAR_ABA"):d.instant("MSG.CONFIRMA_MUDANCA_AMBIENTE_TRABALHO");
a.$openModalConfirm({message:c,callback:function(){a.setLoadingGet(!0);var c=[];l.getModulos().then(function(d){c=d;var f=0;c.forEach(function(c){++f;c=G.get(c.restAngular);l.atualizarUsuario(c,b).then(function(){--f;0===f&&l.atualizarOrganizacaoUsuario(b).then(function(b){a.workspaces=[];a.usuarioLogado=b.originalElement;a.usuarioLogado.organizacao.dataReferenciaVigente=converterStringEmDate(a.usuarioLogado.organizacao.dataReferenciaVigente);a.usuarioLogado.organizacoes=q("itemOrganizacaoDistinct")(a.usuarioLogado.organizacoes,
a.usuarioLogado.organizacao);a.$modalConfirmInstance.dismiss("cancel");a.setLoading(!1)})})})})}})};a.modulos=[];(function(){l.getModulos().then(function(b){a.modulos=b})})();a.isModuloAtivo=function(b){var c=!1;a.modulos.forEach(function(a,d){a.baseUrl===b&&(c=!0)});return c};a.aplicarFiltro=function(a,c,d){return q(c)(a,d)}}]);