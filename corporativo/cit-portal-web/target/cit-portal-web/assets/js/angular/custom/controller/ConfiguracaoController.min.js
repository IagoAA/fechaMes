citApp.controller("ConfiguracaoController",["$scope","$translate","ConfiguracaoRepository","FileUploader","$window","$timeout","ModuloRepository","DominioRepository","$injector",function(a,m,g,n,w,p,s,h,k){function q(){a.uploaderLogoSalvo||void 0===a.configuracao.id||(d.url+=a.configuracao.id,a.uploaderLogoSalvo=!a.uploaderLogoSalvo)}function r(b,a){for(var c="";c.length<a;)c=b+c;return c}a.configuracao={};a.parametro={};a.configuracao.parametros=[];a.uploaderLogoSalvo=!1;a.almoxarifadoAtivo=a.isModuloAtivo("/cit-almoxarifado-web");
a.patrimonioAtivo=a.isModuloAtivo("/citgrp-patrimonio-web");a.admMateriaisAtivo=a.isModuloAtivo("/cit-adm-materiais-web");a.mascara={};h.findAllDominio("tipoMascara").then(function(b){a.radioValueList=b});s.obterModulosAtivos().then(function(b){a.mondulosAtivos=b});a.parametros={};var l=function(){g.getConfiguracao(a.usuarioLogado.organizacao.id).then(function(b){a.configuracao=b.originalElement;void 0==a.configuracao.id?(a.configuracao={},g.save(a.configuracao).then(function(b){a.configuracao=b.originalElement;
q()})):q();t(a.configuracao.parametros)})},u=function(b){a.admMateriaisAtivo&&(k.get(["ContaContabilRepository"]).get(b).then(function(b){a.contaAlmoxarifado=b.originalElement}),k.get(["ContaContabilMovimentoRepository"]).existeVinculo({joinClass:"contaContabil.id",id:b}).then(function(b){p(function(){b&&(a.contaAlmoxarifadoEmUso=!0)})}))},t=function(b){if(b)for(var e,c=0;c<b.length;c++)e=b[c],a.parametro[e.chave]=e.valor,a.parametros[e.chave]=e,"CONTA_CONTABIL_ALMOXARIFADO"==e.chave&&a.admMateriaisAtivo&&
(u(Number(e.valor)),a.defineContaAlmox(Number(e.valor)))},v=function(b){a.configuracao.parametros=[];for(var e in b)if(b.hasOwnProperty(e)){var c={};a.parametros[e]?c=a.parametros[e]:c.chave=e;c.valor=b[e];a.configuracao.parametros.push(c)}},f=a.uploader=new n({autoUpload:!1,queueLimit:1,url:"/cit-portal-web/rest/configuracao/uploadFile"});f.filters.push({name:"imageFilter",fn:function(b,a){var c="|"+b.type.slice(b.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(c)}});f.onWhenAddingFileFailed=
function(b,a,c){console.info("onWhenAddingFileFailed",b,a,c)};f.onAfterAddingFile=function(b){console.info("onAfterAddingFile",b)};f.onAfterAddingAll=function(b){console.info("onAfterAddingAll",b)};f.onBeforeUploadItem=function(b){console.info("onBeforeUploadItem",b)};f.onProgressItem=function(b,a){console.info("onProgressItem",b,a)};f.onProgressAll=function(b){console.info("onProgressAll",b)};f.onSuccessItem=function(b,a,c,d){console.info("onSuccessItem",b,a,c,d)};f.onErrorItem=function(a,e,c,d){console.info("onErrorItem",
a,e,c,d)};f.onCancelItem=function(a,e,c,d){console.info("onCancelItem",a,e,c,d)};f.onCompleteItem=function(a,e,c,d){console.info("onCompleteItem",a,e,c,d)};f.onCompleteAll=function(){console.info("onCompleteAll")};a.saveOrUpdateConfigPaginaLogin=function(){f.uploadAll()};a.saveOrUpdateParametros=function(){a.setLoading(!0);v(a.parametro);g.save(a.configuracao).then(function(b){a.showAlert("success",m.instant("MSG.PARAMETRO_SALVO_COM_SUCESSO"));0<d.queue.length&&d.uploadAll();a.setLoading(!1);p(function(){l()},
2E3)})};a.saveOrUpdateParametrosGeral=function(){5>a.mascara.tamanhoSequencial?a.showAlert("error",m.instant("MSG.INFO_TAMANHO_MASCARA_OPERACAO")):a.saveOrUpdateParametros()};l();var d=a.uploaderLogo=new n({autoUpload:!1,queueLimit:1,url:"/cit-portal-web/rest/configuracao/uploadFileLogo?idOrganizacao\x3d"+a.usuarioLogado.organizacao.id+"\x26idConfiguracao\x3d"});d.filters.push({name:"imageFilter",fn:function(a,e){var c="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(c)}});
d.onWhenAddingFileFailed=function(a,e,c){d.clearQueue();console.info("onWhenAddingFileFailed",a,e,c)};d.onAfterAddingFile=function(a){console.info("onAfterAddingFile",a)};d.onAfterAddingAll=function(a){console.info("onAfterAddingAll",a)};d.onBeforeUploadItem=function(a){console.info("onBeforeUploadItem",a)};d.onProgressItem=function(a,e){console.info("onProgressItem",a,e)};d.onProgressAll=function(a){console.info("onProgressAll",a)};d.onSuccessItem=function(a,e,c,d){console.info("onSuccessItem",a,
e,c,d)};d.onErrorItem=function(a,e,c,d){console.info("onErrorItem",a,e,c,d)};d.onCancelItem=function(a,e,c,d){console.info("onCancelItem",a,e,c,d)};d.onCompleteItem=function(a,e,c,d){console.info("onCompleteItem",a,e,c,d)};d.onCompleteAll=function(){d.clearQueue();l();console.info("onCompleteAll")};h.findAllDominioByCodigo("tipoMaterial",2).then(function(b){a.dominioTipoMaterialPermanente=b.originalElement});a.findContaAlmoxarifado=function(b){if(a.isModuloAtivo("/cit-adm-materiais-web"))return k.get(["ContaContabilRepository"]).findContaContabilPorOrganizacaoEDominioSemUsoMaterial(b,
a.usuarioLogado.organizacao.id,a.dominioTipoMaterialPermanente.id).then(function(a){return a})};a.defineContaAlmox=function(b){a.parametro.CONTA_CONTABIL_ALMOXARIFADO=""+b};a.$watch("almoxarifadoAtivo",function(){a.almoxarifadoAtivo&&h.findAllDominio("tipoAvaliacaoMonetariaEstoque").then(function(b){a.dominiosTipoAvaliacaoMonetariaEstoque=b})});a.configurarMascara=function(){a.mascara.dominioTipoMascara&&0<a.mascara.tamanhoSequencial&&(1==a.mascara.dominioTipoMascara.codigo&&(a.parametro.MASCARA_NUMERO_IDENTIFICACAO=
r(9,a.mascara.tamanhoSequencial)),2==a.mascara.dominioTipoMascara.codigo&&(a.parametro.MASCARA_NUMERO_IDENTIFICACAO="AAAA"+r(9,a.mascara.tamanhoSequencial-4)))}}]);