citApp.directive("bloquearDesbloquear",["$translate","$injector",function(b,d){return{require:["^ngModel"],scope:{model:"\x3dngModel",repository:"@ngRepository",edit:"\x3dngEdit",form:"\x3dform"},replace:!0,restrict:"E",templateUrl:"assets/js/angular/custom/directive/html/bloquearDesbloquear.html",controller:["$scope","$element","$attrs",function(a,b,e){a.id=e.ngModel;a.$buttonLockOpen=!1;a.repositorio=d.get(a.repository);a.appController=angular.element("#citapp-controller").scope();a.dataBloqueio=
null;a.pgEdit=!0}],link:function(a,d,e){a.noCloseDropdown=function(a){a.preventDefault();a.stopPropagation()};a.bloquear=function(){a.dataBloqueio?a.form.$valid||a.appController.showAlert("error",b.instant("VALIDACAO.ALERTA_OBRIGATORIOS")," ",!1):a.appController.showAlert("error",b.instant("MSG.MG011"));if(a.dataBloqueio&&a.form.$valid){var c=converterStringEmDate(a.dataBloqueio);if(c>new Date||a.isDataIguais(c,new Date))a.appController.setLoadingSalva(!0),a.model.dataBloqueio=a.dataBloqueio,a.repositorio.save(a.model).then(function(c){a.appController.setLoadingSalva(!1);
a.model.dataBloqueio=c.originalElement.dataBloqueio;a.model.version=c.originalElement.version;a.dataBloqueio=null;a.appController.showAlert("success",b.instant("MSG.REGISTRO_BLOQUEADO"))})}};a.desbloquear=function(){a.appController.setLoadingSalva(!0);a.model.dataBloqueio=null;a.repositorio.save(a.model).then(function(c){a.appController.setLoadingSalva(!1);a.model.dataBloqueio=c.originalElement.dataBloqueio;a.model.version=c.originalElement.version;a.appController.showAlert("success",b.instant("MSG.REGISTRO_DESBLOQUEADO"))})};
a.isDataIguais=function(a,b){return a.getDate()==b.getDate()&&a.getMonth()==b.getMonth()&&a.getFullYear()==b.getFullYear()}}}}]);