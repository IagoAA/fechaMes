citApp.controller("WidgetController",["$scope","$timeout","$translate","DominioRepository","WidgetRepository","WidgetParametroRepository",function(a,f,c,d,e,g){a.resetForm=function(){a.widget={};a.widget.parametros=[];a.parametro={};a.$edit=!0;a.parametroChecked={};a.dominiosTipoDefault=[];a.documentos=[]};a.fetchResult=function(){angular.element("#widget-list-controller").scope().fetchResult()};d.findAllChavesDominio().then(function(b){a.chavesDominio=b});a.atualizarDominiosDefault=function(){f(function(){a.parametro.chaveDominioDefault&&
d.findAllDominio(a.parametro.chaveDominioDefault).then(function(b){a.dominiosTipoDefault=b})})};d.findAllDominio("tipoDado").then(function(b){a.listaTipoWidgetParametro=[];b.forEach(function(b){7!=b.originalElement.codigo&&8!=b.originalElement.codigo&&a.listaTipoWidgetParametro.push(b.originalElement)})});d.findAllDominio("tipoWidget").then(function(b){a.tiposWidget=b});d.findAllDominio("tipoHighChart").then(function(b){a.tiposHighChart=b});a.loadWidgetEdit=function(b,c){a.$showPageEditWorkspace(a.workspace);
e.get(b).then(function(b){a.widget=b.originalElement});a.$edit=c};a.remove=function(b){a.widget=b;a.$openModalConfirm({message:c.instant("MSG.CONFIRMA_EXCLUIR_WIDGET"),callback:function(){e.remove(a.widget).then(function(){a.$modalConfirmInstance.dismiss("cancel");a.showAlert("success",c.instant("MSG.SUCESSO_WIDGET_EXCLUIDO"));angular.element("#widget-list-controller").scope().fetchResult();a.$showPageSearchWorkspace(a.workspace);a.resetForm()})}})};a.$watch("parametro",function(){a.parametro.tipoWidgetParametroDominio&&
6===a.parametro.tipoWidgetParametroDominio.codigo&&a.parametro.chaveDominioDefault&&d.findAllDominio(a.parametro.chaveDominioDefault).then(function(b){a.dominiosTipoDefault=b})});a.saveOrUpdate=function(){a.formWidgetEdit.$submitted=!0;a.formWidgetEdit.$invalid?a.showAlert("error",c.instant("MSG.MN001")):(a.setLoading(!0),e.save(a.widget).then(function(b){a.showAlert("success",c.instant("MSG.WIDGET_SALVO_COM_SUCESSO"));a.resetForm();a.setLoading(!1);a.formWidgetEdit.$submitted=!1}))};a.resetForm();
a.addAndUpdateWidgetParametro=function(){if(9===a.parametro.tipoWidgetParametroDominio.codigo)if(a.parametro.nome=a.parametro.tipoWidgetParametroDominio.descricao,!a.widget.urlServico||void 0!==a.parametro.$index&&null!==a.parametro.$index)a.widget.urlServico=a.parametro.textoDefault;else{a.showAlert("error",c.instant("MSG.URL_SERVICO_DUPLICADA"));return}if(a.parametro.nome)if(a.parametro.tipoWidgetParametroDominio&&a.parametro.tipoWidgetParametroDominio.id){var b=angular.copy(a.parametro);void 0!==
b.$index&&null!==b.$index?a.widget.parametros[b.$index]=b:a.widget.parametros.push(b);a.parametro={};a.$modalInstance.dismiss("cancel")}else a.showAlert("error",c.instant("MSG.SELECIONE_TIPO_PARAMETRO"));else a.showAlert("error",c.instant("MSG.INFORME_NOME__PARAMETRO"))};a.loadWidgetParametro=function(){a.parametroChecked.nome?(a.parametro=angular.copy(a.parametroChecked),a.parametroChecked={},a.$openModal("addParametroModal.html")):a.showAlert("warning",c.instant("MSG.SELECIONE_UM_ITEM_PARA_EDICAO"))};
a.removeWidgetParametro=function(){if(a.parametroChecked.nome){var b=a.parametroChecked;b.id?a.$openModalConfirm({message:c.instant("MSG.CONFIRMA_EXCLUIR_PARAMETRO"),callback:function(){a.setLoadingRemove(!0);g.remove(b).then(function(d){a.$modalConfirmInstance.dismiss("cancel");a.showAlert("success",c.instant("MSG.SUCESSO_PARAMETRO_EXCLUIDO"));a.setLoadingRemove(!1);a.widget.parametros.splice(b.$index,1)})}}):a.widget.parametros.splice(b.$index,1)}else a.showAlert("warning",c.instant("MSG.SELECIONE_UM_ITEM_PARA_SER_REMOVIDO"))};
a.fecharModalWidgetParametro=function(){a.parametro={}}}]);