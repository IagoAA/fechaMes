citApp.controller("PessoaController",["$scope","PessoaRepository","DominioRepository","$filter","FuncaoRepository","UsuarioRepository","$translate","$timeout","$injector","EstruturaOrganizacionalRepository","FileUploader","ServicoRepository",function(a,e,h,k,m,n,d,g,l,p,q,r){a.funcionario={anexos:[]};a.isVisualizar=!1;a.edit=!1;a.tiposPessoa={};a.tiposPorte={};a.tiposAbrangencia={};a.dominiosSexo={};a.dominiosEstadoCivil={};a.pessoaVH={};a.contato={};a.MASK_CNPJ="99.999.999/9999-99";a.MASK_CPF="999.999.999-99";
a.MASK_TELEFONE="(99) 9999?9-9999";a.dominiosTipoParceiroSelecionados=[];a.dominioTipoParceiro={};a.apresentarColaborador=!1;a.apresentarOrgaoExterno=!1;a.apresentarPortador=!1;a.apresentarFornecedor=!1;a.apresentarSeguradora=!1;a.apresentarCliente=!1;a.apresentarFuncionario=!1;a.colaborador={};a.orgaoExterno={};a.portador={};a.fornecedor={};a.seguradora={};a.cliente={};a.funcionario={};a.fornecedorObservacao={};a.fornecedorRamoAtividade={};a.contatoInvalid=!1;a.apresentarBotaoBloquear=!1;a.moduloAdmMateriaisAtivo=
!1;a.pessoa={telefones:[],enderecos:[],contatos:[]};a.admMateriaisAtivo=a.isModuloAtivo("/cit-adm-materiais-web");a.findEstrutura=function(b){return p.listarEstruturasOrganizacionaisPorOrganizacao(b,a.usuarioLogado.organizacao.id).then(function(a){return a})};h.findAllDominio("tipoPessoa").then(function(b){a.tiposPessoa=b});h.findAllDominio("tipoPorte").then(function(b){a.tiposPorte=b});h.findAllDominio("tipoAbrangencia").then(function(b){a.tiposAbrangencia=b});h.findAllDominio("tipoSexo").then(function(b){a.dominiosSexo=
b});h.findAllDominio("tipoEstadoCivil").then(function(b){a.dominiosEstadoCivil=b});a.findAllDominioTipoParceiro=function(){a.tiposParceiro=[];h.findAllDominio("tipoParceiro").then(function(b){angular.forEach(b,function(b){4!==b.codigo&&6!==b.codigo&&7!==b.codigo||a.tiposParceiro.push(b)})})};a.removerPessoa=function(){a.setLoadingRemove(!0);e.remove(a.pessoa).then(function(b){a.setLoadingRemove(!1);a.resetForm();a.showAlert("success",d.instant("MSG.MG001"))});a.$modalConfirmInstance.dismiss("cancel")};
a.bloquearPessoa=function(){a.pessoa.dataBloqueio?a.saveOrUpdate():a.showAlert("error",d.instant("MSG.MG011"))};a.saveOrUpdate=function(){if(a.pessoa.dataBloqueio)a.showAlert("error",d.instant("VALIDACAO.REGISTRO_BLOQUEADO_NAO_PODE_SER_ALTERADO"));else if(a.formPessoa.$submitted=!0,a.formPessoa.$invalid)a.showAlert("error",d.instant("MSG.MN001"));else{a.colaborador.estruturaOrganizacional&&(delete a.colaborador.estruturaOrganizacional.classificacao,delete a.colaborador.estruturaOrganizacional.organizacao);
var b={pessoa:a.pessoa,colaborador:a.colaborador,orgaoExterno:a.orgaoExterno,portador:a.portador,fornecedor:a.fornecedor,seguradora:a.seguradora,cliente:a.cliente,funcionario:a.funcionario,dominiosTipoParceiroSelecionados:a.dominiosTipoParceiroSelecionados};a.pessoa.parceiros=null;a.setLoadingSalva(!0);e.save(b).then(function(b){a.pessoa=b.originalElement;a.apresentarBotaoBloquear=!a.pessoa.dataBloqueio;a.dominiosTipoParceiroSelecionados=[];angular.forEach(a.pessoa.parceiros,function(b){a.adicionarParceiroEdicao(b)});
a.setLoading(!1);a.showAlert("success",d.instant("MSG.MG001"));a.resetForm()})}};a.desbloquearPessoa=function(){a.pessoa.dataBloqueio=null;a.saveOrUpdate()};a.getPessoa=function(b,f){a.formPessoa.$submitted=!1;a.setLoadingGet(!0);a.resetForm();a.edit=!0;g(function(){e.get(b).then(function(b){a.pessoa=b.originalElement;a.isVisualizar=f;a.apresentarBotaoBloquear=!a.pessoa.dataBloqueio;a.setLoading(!1);angular.forEach(a.pessoa.parceiros,function(b){a.adicionarParceiroEdicao(b)})})})};a.adicionarParceiroEdicao=
function(b){1==b.classeParceiro.dominioTipoParceiro.codigo?(a.apresentarColaborador=!0,a.colaborador=b):2==b.classeParceiro.dominioTipoParceiro.codigo?(a.apresentarOrgaoExterno=!0,a.orgaoExterno=b):3==b.classeParceiro.dominioTipoParceiro.codigo?(a.apresentarPortador=!0,a.portador=b):4==b.classeParceiro.dominioTipoParceiro.codigo?(a.apresentarFornecedor=!0,a.fornecedor=b):5==b.classeParceiro.dominioTipoParceiro.codigo?(a.apresentarSeguradora=!0,a.seguradora=b):6==b.classeParceiro.dominioTipoParceiro.codigo?
(a.apresentarCliente=!0,a.cliente=b):7==b.classeParceiro.dominioTipoParceiro.codigo&&(a.apresentarFuncionario=!0,a.funcionario=b);a.dominiosTipoParceiroSelecionados.push(b.classeParceiro.dominioTipoParceiro);a.tiposParceiro=k("idNotEqualDominio")(a.tiposParceiro,a.dominiosTipoParceiroSelecionados)};a.resetForm=function(){a.isVisualizar=!1;a.findAllDominioTipoParceiro();a.dominiosTipoParceiroSelecionados=[];a.dominioTipoParceiro={};a.apresentarColaborador=!1;a.apresentarOrgaoExterno=!1;a.apresentarPortador=
!1;a.apresentarFornecedor=!1;a.apresentarSeguradora=!1;a.apresentarCliente=!1;a.apresentarFuncionario=!1;a.colaborador={};a.orgaoExterno={};a.portador={};a.fornecedor={};a.seguradora={};a.cliente={};a.funcionario={};a.contato={};a.pessoa={telefones:[],enderecos:[],contatos:[]};g(function(){a.formPessoa.$submitted=!1;a.formPessoa.$setPristine();a.formPessoa["endereco.cep"]&&(a.formPessoa["endereco.cep"].$setViewValue(""),a.formPessoa["endereco.cep"].$render());a.formPessoa["endereco.complemento"]&&
(a.formPessoa["endereco.complemento"].$setViewValue(""),a.formPessoa["endereco.complemento"].$render());a.formPessoa["endereco.logradouro"]&&(a.formPessoa["endereco.logradouro"].$setViewValue(""),a.formPessoa["endereco.logradouro"].$render());a.formPessoa["endereco.numero"]&&(a.formPessoa["endereco.numero"].$setViewValue(""),a.formPessoa["endereco.numero"].$render());a.formPessoa.pais&&(a.formPessoa.pais.$setViewValue(""),a.formPessoa.pais.$render());a.formPessoa.regiao&&(a.formPessoa.regiao.$setViewValue(""),
a.formPessoa.regiao.$render());a.formPessoa.estado&&(a.formPessoa.estado.$setViewValue(""),a.formPessoa.estado.$render());a.formPessoa.cidade&&(a.formPessoa.cidade.$setViewValue(""),a.formPessoa.cidade.$render());a.formPessoa.bairro&&(a.formPessoa.bairro.$setViewValue(""),a.formPessoa.bairro.$render());a.formPessoa["telefone.numero"]&&(a.formPessoa["telefone.numero"].$setViewValue(""),a.formPessoa["telefone.numero"].$render());a.formPessoa["pessoa.email"]&&(a.formPessoa["pessoa.email"].$setViewValue(""),
a.formPessoa["pessoa.email"].$render())})};a.adicionarParceiro=function(b){1==b.codigo?(a.apresentarColaborador=!0,a.colaborador={},a.activeOrgaoExterno=!1,a.activePortador=!1,a.activeFornecedor=!1,a.activeSeguradora=!1,a.activeCliente=!1,a.activeFuncionario=!1,g(function(){a.activeColaborador=!0})):2==b.codigo?(a.apresentarOrgaoExterno=!0,a.orgaoExterno={},a.activeColaborador=!1,a.activePortador=!1,a.activeFornecedor=!1,a.activeSeguradora=!1,a.activeCliente=!1,a.activeFuncionario=!1,g(function(){a.activeOrgaoExterno=
!0})):3==b.codigo?(a.apresentarPortador=!0,a.portador={},a.activeColaborador=!1,a.activeOrgaoExterno=!1,a.activeFornecedor=!1,a.activeSeguradora=!1,a.activeCliente=!1,a.activeFuncionario=!1,g(function(){a.activePortador=!0})):4==b.codigo?(a.apresentarFornecedor=!0,a.fornecedor={},a.activeColaborador=!1,a.activeOrgaoExterno=!1,a.activePortador=!1,a.activeSeguradora=!1,a.activeCliente=!1,a.activeFuncionario=!1,g(function(){a.activeFornecedor=!0})):5==b.codigo?(a.apresentarSeguradora=!0,a.seguradora=
{},a.activeColaborador=!1,a.activeOrgaoExterno=!1,a.activePortador=!1,a.activeFornecedor=!1,a.activeCliente=!1,a.activeFuncionario=!1,g(function(){a.activeSeguradora=!0})):6==b.codigo?(a.apresentarCliente=!0,a.cliente={},a.activeColaborador=!1,a.activeOrgaoExterno=!1,a.activePortador=!1,a.activeFornecedor=!1,a.activeSeguradora=!1,a.activeFuncionario=!1,g(function(){a.activeCliente=!0})):7==b.codigo&&(a.apresentarFuncionario=!0,a.funcionario={},a.activeColaborador=!1,a.activeOrgaoExterno=!1,a.activePortador=
!1,a.activeFornecedor=!1,a.activeCliente=!1,a.activeSeguradora=!1,g(function(){a.activeFuncionario=!0}));b.originalElement?a.dominiosTipoParceiroSelecionados.push(b.originalElement):a.dominiosTipoParceiroSelecionados.push(b);a.tiposParceiro=k("idNotEqualDominio")(a.tiposParceiro,a.dominiosTipoParceiroSelecionados);a.dominioTipoParceiro={};b={};a.formPessoa.$submitted=!1};a.removerParceiro=function(){angular.forEach(a.dominiosTipoParceiroSelecionados,function(b){b.codigo==a.codigoParceiroRemocao&&
(b.originalElement?a.dominiosTipoParceiroSelecionados.splice(a.dominiosTipoParceiroSelecionados.indexOf(b.originalElement),1):a.dominiosTipoParceiroSelecionados.splice(a.dominiosTipoParceiroSelecionados.indexOf(b),1),a.tiposParceiro.push(b),a.removerAbaParceiro(),a.removerEntidadeParceiro(b))});a.$modalConfirmInstance.dismiss("cancel")};a.removerEntidadeParceiro=function(b){1==b.codigo&&a.colaborador.id?e.removeColaborador(a.colaborador.id).then(function(b){a.colaborador={}}):2==b.codigo&&a.orgaoExterno.id?
e.removeOrgaoExterno(a.orgaoExterno.id).then(function(b){a.orgaoExterno={}}):3==b.codigo&&a.portador.id?e.removePortador(a.portador.id).then(function(b){a.portador={}}):4==b.codigo&&a.fornecedor.id?e.removeFornecedor(a.fornecedor.id).then(function(b){a.fornecedor={}}):5==b.codigo&&a.seguradora.id?e.removeSeguradora(a.seguradora.id).then(function(b){a.seguradora={}}):6==b.codigo&&a.cliente.id?e.removeCliente(a.cliente.id).then(function(b){a.cliente={}}):6==b.codigo&&a.funcionario.id&&e.removeFuncionario(a.funcionario.id).then(function(b){a.funcionario=
{}})};a.removerAbaParceiro=function(){1==a.codigoParceiroRemocao?a.apresentarColaborador=!1:2==a.codigoParceiroRemocao?a.apresentarOrgaoExterno=!1:3==a.codigoParceiroRemocao?a.apresentarPortador=!1:4==a.codigoParceiroRemocao?a.apresentarFornecedor=!1:5==a.codigoParceiroRemocao?a.apresentarSeguradora=!1:6==a.codigoParceiroRemocao?a.apresentarCliente=!1:7==a.codigoParceiroRemocao&&(a.apresentarFuncionario=!1)};a.findFuncao=function(b){return m.findFuncaoPorOrganizacao(b,a.usuarioLogado.organizacao.id).then(function(a){return a})};
a.findServico=function(b){return r.findServicoPorOrganizacao(b,a.usuarioLogado.organizacao.id).then(function(a){return a})};a.editObservacao=function(){angular.forEach(a.fornecedor.observacoes,function(b,f){b.$checked&&(a.fornecedorObservacao=b,a.fornecedorObservacao.$edit=!0)})};a.adicionarObservacaoFornecedor=function(){a.fornecedor.observacoes||(a.fornecedor.observacoes=[]);if(!a.fornecedorObservacao.$edit){var b={};angular.copy(a.fornecedorObservacao,b);a.fornecedor.observacoes.push(b)}a.fornecedorObservacao=
{};a.fornecedorObservacao.$edit=!1};a.checkObservacao=function(b){a.removeCheckedObservacao();b.$checked=!0};a.removeCheckedObservacao=function(){a.fornecedor.observacoes.forEach(function(a){a.$checked=!1})};a.apresentarDialogConfirmacaoRemocaoObservacao=function(){a.$openModalConfirm({message:d.instant("LABEL.CONFIRMA_EXCLUSAO"),callback:a.removerObservacao})};a.removerObservacao=function(){angular.forEach(a.fornecedor.observacoes,function(b,f){b.$checked&&(b.id&&e.removeFornecedorObservacao(b.id).then(function(a){}),
a.fornecedor.observacoes.splice(f,1))});a.$modalConfirmInstance.dismiss("cancel")};a.findGrupo=function(a){return l.get(["ClassificacaoMaterialRepository"]).listarClassificacaoMaterial(a,1).then(function(a){return a})};a.findSubGrupo=function(b){return l.get(["ClassificacaoMaterialRepository"]).listarFilhosPorDescricaoIdParent(b,a.fornecedorRamoAtividade.grupoFederalSupply.id).then(function(b){return k("idNotEqualClassificacaoMaterial")(b,a.fornecedor.fornecedorRamoAtividades)})};a.adicionarRamoAtividade=
function(){if(a.fornecedorRamoAtividade.subGrupoFederalSupply){a.fornecedor.fornecedorRamoAtividades||(a.fornecedor.fornecedorRamoAtividades=[]);var b={};angular.copy(a.fornecedorRamoAtividade,b);a.fornecedor.fornecedorRamoAtividades.push(b);a.fornecedorRamoAtividade={}}};a.checkRamoAtividade=function(b){a.removeCheckedRamoAtividade();b.$checked=!0};a.removeCheckedRamoAtividade=function(){a.fornecedor.fornecedorRamoAtividades.forEach(function(a){a.$checked=!1})};a.apresentarDialogConfirmacaoRemocaoRamoAtividade=
function(){a.$openModalConfirm({message:d.instant("LABEL.CONFIRMA_EXCLUSAO"),callback:a.removerFornecedorRamoAtividade})};a.removerFornecedorRamoAtividade=function(){angular.forEach(a.fornecedor.fornecedorRamoAtividades,function(b,f){b.$checked&&(b.id&&e.removeFornecedorRamoAtividade(b.id).then(function(a){}),a.fornecedor.fornecedorRamoAtividades.splice(f,1))});a.$modalConfirmInstance.dismiss("cancel")};a.adicionarContato=function(){a.pessoa.contatos||(a.pessoa.contatos=[]);if(a.existeRepresentanteLegal()&&
!0===a.contato.representanteLegal)a.showAlert("error",d.instant("VALIDACAO.REPRESENTANTE_LEGAL_UNICO"));else if(!0!==a.contato.representanteLegal||a.contato.cpf)if(CPF.isValid(a.contato.cpf))if(a.contato.nome){a.nomeInvalid=!1;if(!a.contato.$edit){var b={};angular.copy(a.contato,b);a.pessoa.contatos.push(b)}a.contato={};a.contato.$edit=!1}else a.nomeInvalid=!0;else a.showAlert("error",d.instant("VALIDACAO.CPF_INVALIDO_CONTATO"));else a.showAlert("error",d.instant("VALIDACAO.CPF_OBRIGATORIO_REPRESENTANTE_LEGAL"))};
a.existeRepresentanteLegal=function(){var b=!1;angular.forEach(a.pessoa.contatos,function(a,c){a.representanteLegal&&(b=!0)});return b};a.apresentarDialogConfirmacaoRemocaoContato=function(){a.$openModalConfirm({message:d.instant("LABEL.CONFIRMA_EXCLUSAO"),callback:a.removerContato})};a.checkContato=function(b){a.removeCheckedContato();b.$checked=!0};a.removeCheckedContato=function(){a.pessoa.contatos.forEach(function(a){a.$checked=!1})};a.removerContato=function(){angular.forEach(a.pessoa.contatos,
function(b,f){b.$checked&&(b.id&&e.removeContato(b.id).then(function(a){}),a.pessoa.contatos.splice(f,1))});a.$modalConfirmInstance.dismiss("cancel")};a.apresentarDialogConfirmacaoRemocaoParceiro=function(b){a.codigoParceiroRemocao=b;a.$openModalConfirm({message:d.instant("LABEL.CONFIRMA_EXCLUSAO"),callback:a.removerParceiro})};a.apresentarDialogConfirmacaoRemocaoPessoa=function(){a.$openModalConfirm({message:d.instant("LABEL.CONFIRMA_EXCLUSAO"),callback:a.removerPessoa})};a.habilitarSalvar=function(){a.isVisualizar=
!1};a.fetchResult=function(){angular.element("#searchPessoa").scope().fetchResult()};a.findUsuario=function(a){return n.findByUsername(a).then(function(a){return a})};a.setUsuario=function(b){b&&b.id&&(a.pessoa.usuario=b)};a.limparUsuario=function(){a.pessoa.usuario=null};var c=a.uploader=new q({autoUpload:!1,queueLimit:30,url:"/cit-tabelas-corp-web/rest/funcionarioAnexo/uploadMultipleFile?idFuncionario\x3d"});c.filters.push({name:"fileFilter",fn:function(a,f){var c="|"+a.type.slice(a.type.lastIndexOf("/")+
1)+"|";return-1!=="|vnd.oasis.opendocument.text|jpg|png|jpeg|bmp|gif|vnd.ms-excel|csv|msword|vnd.openxmlformats-officedocument.wordprocessingml.document|odt|pdf|vnd.openxmlformats-officedocument.spreadsheetml.sheet|".indexOf(c)}});c.filters.push({name:"tamanhoFilter",fn:function(a,f){return 2E7>a.size}});c.onWhenAddingFileFailed=function(b,f,c){var e="|"+b.type.slice(b.type.lastIndexOf("/")+1)+"|";2E7<b.size?a.showAlert("error",d.instant("CONTRATOS.MSG.ANEXO_TAMANHO_INVALIDO")):-1==="|vnd.oasis.opendocument.text|jpg|png|jpeg|bmp|gif|vnd.ms-excel|csv|msword|vnd.openxmlformats-officedocument.wordprocessingml.document|odt|pdf|vnd.openxmlformats-officedocument.spreadsheetml.sheet|".indexOf(e)?
a.showAlert("error",d.instant("CONTRATOS.MSG.ANEXO_FORMATO_INVALIDO")):console.info("onWhenAddingFileFailed",b,f,c)};c.onAfterAddingFile=function(a){console.info("onAfterAddingFile",a)};c.onAfterAddingAll=function(a){console.info("onAfterAddingAll",a)};c.onBeforeUploadItem=function(a){console.info("onBeforeUploadItem",a)};c.onProgressItem=function(a,f){console.info("onProgressItem",a,f)};c.onProgressAll=function(a){console.info("onProgressAll",a)};c.onSuccessItem=function(a,f,c,d){console.info("onSuccessItem",
a,f,c,d)};c.onErrorItem=function(a,f,c,d){console.info("onErrorItem",a,f,c,d)};c.onCancelItem=function(a,c,d,e){console.info("onCancelItem",a,c,d,e)};c.onCompleteItem=function(a,c,d,e){console.info("onCompleteItem",a,c,d,e)};c.onCompleteAll=function(){c.clearQueue();console.info("onCompleteAll")};a.salvarUpload=function(a){angular.forEach(c.queue,function(c,d){c.url+=a.originalElement.id});c.uploadAll()};a.removerUploadAnexoFuncionario=function(b){if(b.id)FuncionarioAnexoRepository.remove(b).then(function(c){c=
a.funcionario.anexos.indexOf(b);a.funcionario.anexos.splice(c,1)});else{var d=c.queue.indexOf(b);c.queue.splice(d,1)}};a.visualizarArquivo=function(b){confuncionarioxoSelecionado.id?(a.url="/cit-tabelas-corp-web/rest/funcionarioAnexo/visualizarArquivo?idFuncionarioAnexo\x3d"+b.id,a.$openModal("visualizarArquivos","lg")):a.showAlert("warning",d.instant("MSG.SELECIONE_UM_ITEM_PARA_VISUALIZACAO"))}}]);