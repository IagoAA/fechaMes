citApp.directive("componenteAssociarDocumentos",["$translate","FileUploader","DominioRepository","ParceiroRepository","DocumentoRepository","$modal","$filter","$timeout","AnexoRepository",function(d,e,f,g,h,k,l,m,n){return{scope:{documentos:"\x3dngDocumentos",edit:"\x3dngEdit",form:"\x3dform",uploader:"\x3dngUploader",workspace:"\x3dngWorkspace",obrigatorio:"\x3dngObrigatorio",labelAlertTooltip:"@"},replace:!0,restrict:"E",templateUrl:"/cit-tabelas-corp-web/assets/js/angular/custom/directive/html/associarDocumentos.html",
controller:["$scope",function(a){a.appController=angular.element("#citapp-controller").scope();a.labelAlertTooltipCopy=a.labelAlertTooltip;void 0===a.labelAlertTooltip&&(a.labelAlertTooltipCopy=d.instant("LABEL.ASSOCIAR_DOCUMENTOS")+" "+d.instant("LABEL.CAMPO_OBRIGATORIO"))}],link:function(a,e,m){a.openModal=function(b,c){void 0!==b&&(a.$modalInstance=k.open({templateUrl:b,size:c,windowClass:"modal-buttons-top modal-no-backdrop mod-green",backdrop:!1,scope:this}))};a.inicializarModalDocumentos=function(){a.editDocumento=
!0;a.documento={anexos:[],$uuid:getUuid()};a.uploader.queue&&0<a.uploader.queue.length&&a.uploader.queue.splice(a.uploader.queue[0],1);a.openModal("modal-documentos.html")};a.uploader.onCompleteAll=function(){a.uploader.clearQueue();console.info("onCompleteAll")};a.salvarAdicionarDocumento=function(b){var c=new Date;b.$submitted=!0;if(!b.$valid||a.documento.dataEmissao.getTime()>c)b.$valid&&a.documento.dataEmissao.getTime()>c?a.$parent.showAlert("error",d.instant("VALIDACAO.DATA_EMISSAO_DATA_ATUAL")):
b.$invalid&&a.$parent.showAlert("error",d.instant("VALIDACAO.ALERTA_OBRIGATORIOS"));else{a.documento.uploadsDocumento=a.uploader.getNotUploadedItems();if(void 0==a.documentos||null==a.documentos)a.documentos=[];a.dominiosTipoDocumento.forEach(function(b,c){a.documento.dominioTipoDocumento.id===b.id&&(a.documento.dominioTipoDocumento=b.originalElement)});a.documentos.forEach(function(b,c){b.$uuid===a.documento.$uuid&&a.documentos.splice(c,1)});a.documentos.push(a.documento);a.$modalInstance.dismiss("cancel")}};
a.removerDocumento=function(){var b=a.getDocumentoChecked();void 0!==b?a.appController.$openModalConfirm({message:d.instant("MSG.DESEJA_EXCLUIR_ITENS"),callback:a.excluir,item:b}):a.appController.showAlert("warning",d.instant("MSG.SELECIONE_ITEM_EXCLUIR"))};a.excluir=function(){var b=this.item;void 0!==b.id&&(h.remove(b),a.appController.showAlertSucesso("success",d.instant("MSG.REGISTRO_EXCLUIDO")));a.documentos.splice(b.$index,1);a.appController.$modalConfirmInstance.dismiss("cancel")};a.visualizarDocumento=
function(b){var c=angular.copy(a.getDocumentoChecked());void 0!==c?(a.editDocumento=b,a.documento=c,a.documento.dataEmissao=l("date")(c.dataEmissao,"dd/MM/yyyy"),a.documento.id&&a.documento.emitente&&(a.documento.emitente["pessoa.nome"]=a.documento.emitente.pessoa.nome),c.uploadsDocumento?a.uploader.queue=c.uploadsDocumento:a.uploader.queue&&a.uploader.queue.splice(a.uploader.queue[0],1),a.openModal("modal-documentos.html")):b?a.appController.showAlert("warning",d.instant("MSG.SELECIONE_UM_ITEM_PARA_EDICAO")):
a.appController.showAlert("warning",d.instant("MSG.SELECIONE_UM_ITEM_PARA_VISUALIZACAO"))};f.findAllDominio("tipoDocumento").then(function(b){a.dominiosTipoDocumento=b});a.findEmissorParceiros=function(a){return g.findParceiros("tipoParceiro",["FORNECEDOR","ORGAO_EXTERNO","PORTADOR"],a).then(function(a){return a})};a.documentosIsEmpty=function(){return void 0==a.documentos||null==a.documentos||0==a.documentos.length};a.checkDocumento=function(b){a.removeDocumento();b.$checked=!0};a.removeDocumento=
function(){a.documentos.forEach(function(a){a.$checked=!1})};a.getDocumentoChecked=function(){var b=void 0;a.documentos.forEach(function(a){a.$checked&&(b=a)});return b};a.removerAnexo=function(b){b&&b.id&&a.appController.$openModalConfirm({message:d.instant("MSG.DESEJA_EXCLUIR_ITENS"),callback:a.excluirAnexo,item:b})};a.excluirAnexo=function(){var b=this.item;b.id&&(n.remove(b),a.documento.anexos.forEach(function(c,d){c.id===b.id&&a.documento.anexos.splice(d,1)}),a.appController.showAlertSucesso("success",
d.instant("MSG.REGISTRO_EXCLUIDO")),a.appController.$modalConfirmInstance.dismiss("cancel"))};a.visualizarImagem=function(b){b.id?(a.url="/cit-tabelas-corp-web/rest/anexo/visualizarImagem?idAnexo\x3d"+b.id,a.openModal("visualizarArquivos","lg")):a.showAlert("warning",d.instant("MSG.SELECIONE_UM_ITEM_PARA_VISUALIZACAO"))}}}}]);