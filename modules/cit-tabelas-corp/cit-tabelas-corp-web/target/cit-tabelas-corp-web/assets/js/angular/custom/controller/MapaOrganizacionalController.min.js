citApp.controller("MapaOrganizacionalController",["$scope","MapaOrganizacionalRepository","$filter","$translate","$timeout",function(a,d,f,e,g){a.dialog;a.mapaOrganizacional={observacoes:[]};a.organizacao=a.usuarioLogado.organizacao;a.edit=!0;a.resetForm=function(){a.mapaOrganizacional={dataInicio:f("date")(new Date,"dd/MM/yyyy"),observacoes:[]};a.edit=!0;g(function(){a.formMapaOrganizacional.$submitted=!1;a.formMapaOrganizacional.$setPristine();a.formMapaOrganizacional["observacao.descricao"]&&(a.formMapaOrganizacional["observacao.descricao"].$setViewValue(""),
a.formMapaOrganizacional["observacao.descricao"].$render())})};a.limpar=function(){a.resetForm()};a.atualizaPaginaPesquisa=function(){angular.element("#mapaOrganizacionalList").scope().fetchResult()};a.saveOrUpdate=function(){a.formMapaOrganizacional.$submitted=!0;a.formMapaOrganizacional.$valid?(a.mapaAtivo={},a.mapaOrganizacional&&void 0===a.mapaOrganizacional.id?d.findMapaAtivo().then(function(b){var c=!0;b.id&&a.validaDataInicio(b.originalElement.dataInicio)&&(c=!1,a.mapaOrganizacional.dataInicio=
"",a.showAlert("error",e.instant("VALIDACAO.CAMPO_DATA_INICIO_MAPA")+" ("+b.originalElement.dataInicio+")"));c&&(a.setLoadingSalva(!0),d.save(a.mapaOrganizacional).then(function(b){a.setLoading(!1);a.showAlert("success",e.instant("LABEL.MAPA_ORGANIZACIONAL_SALVO_SUCESSO"));a.mapaOrganizacional=b.originalElement;a.formMapaOrganizacional.$submitted=!1}))}):(a.setLoadingSalva(!0),d.save(a.mapaOrganizacional).then(function(b){a.setLoading(!1);a.showAlert("success",e.instant("LABEL.MAPA_ORGANIZACIONAL_SALVO_SUCESSO"));
a.mapaOrganizacional=b.originalElement}))):a.showAlert("error",e.instant("VALIDACAO.ALERTA_OBRIGATORIOS")," ",!1);a.formMapaOrganizacional.$submitted=!1};void 0==a.$parent||a.$parent.newObejct&&0==a.$parent.idObejct?a.organizacao=a.usuarioLogado.organizacao:(a.setLoadingGet(!0),d.get(a.$parent.idObejct).then(function(b){a.mapaOrganizacional=b.originalElement;a.setLoading(!1)}));a.getMapaOrganizacional=function(b,c){0!=b&&(d.get(b).then(function(b){a.mapaOrganizacional=b.originalElement;a.organizacao=
a.usuarioLogado.organizacao}),a.edit=c)};a.remove=function(b){d.findUltimoMapaFechado().then(function(c){void 0===c.originalElement.id||null===c.originalElement.id?a.showAlert("error",e.instant("VALIDACAO.ULTIMO_MAPA_VIGENTE")):a.$openModalConfirm({message:e.instant("MSG.EXCLUSAO_MAPA_ORGANIZACIONAL"),callback:function(){d.remove(b).then(function(){a.mapaOrganizacional={};a.$modalConfirmInstance.dismiss("cancel");a.showAlert("success",e.instant("LABEL.MAPA_EXCLUIDO_SALVO_SUCESSO")," ",!1);angular.element("#mapaOrganizacionalList").scope().fetchResult();
a.edit=!0})}})})};a.validaDataInicio=function(b){b=converterStringEmDate(f("date")(b,"dd/MM/yyyy"));var c=converterStringEmDate(f("date")(a.mapaOrganizacional.dataInicio,"dd/MM/yyyy")),d=c.getDate();c.setDate(d-1);return c.getTime()<=b.getTime()}}]);